# $Id$

ALTER TABLE OFA_T_DOSSIER ADD COLUMN DOS_SIREN           VARCHAR(20)               COMMENT 'Siren identifier';
ALTER TABLE OFA_T_DOSSIER ADD COLUMN DOS_EXE_ID          INTEGER                   COMMENT 'Exercice identifier';
ALTER TABLE OFA_T_DOSSIER ADD COLUMN DOS_EXE_BEGIN       DATE                      COMMENT 'Exercice beginning date';
ALTER TABLE OFA_T_DOSSIER ADD COLUMN DOS_EXE_END         DATE                      COMMENT 'Exercice ending date';
ALTER TABLE OFA_T_DOSSIER ADD COLUMN DOS_EXE_NOTES       VARCHAR(4096)             COMMENT 'Exercice notes';
ALTER TABLE OFA_T_DOSSIER ADD COLUMN DOS_LAST_ENTRY      BIGINT  DEFAULT 0         COMMENT 'Last entry number used';
ALTER TABLE OFA_T_DOSSIER ADD COLUMN DOS_LAST_BAT        BIGINT  DEFAULT 0         COMMENT 'Last BAT file number used';
ALTER TABLE OFA_T_DOSSIER ADD COLUMN DOS_LAST_BATLINE    BIGINT  DEFAULT 0         COMMENT 'Last BAT line number used';
ALTER TABLE OFA_T_DOSSIER ADD COLUMN DOS_LAST_SETTLEMENT BIGINT  DEFAULT 0         COMMENT 'Last settlement number used';
ALTER TABLE OFA_T_DOSSIER ADD COLUMN DOS_STATUS          CHAR(1)                   COMMENT 'Status of this exercice';

UPDATE OFA_T_DOSSIER SET DOS_EXE_ID=1 WHERE DOS_ID=1;
UPDATE OFA_T_DOSSIER SET DOS_EXE_BEGIN=(SELECT DOS_EXE_BEGIN FROM OFA_T_DOSSIER_EXE WHERE DOS_ID=1 AND DOS_EXE_ID=1) WHERE DOS_ID=1;
UPDATE OFA_T_DOSSIER SET DOS_EXE_END=(SELECT DOS_EXE_END FROM OFA_T_DOSSIER_EXE WHERE DOS_ID=1 AND DOS_EXE_ID=1) WHERE DOS_ID=1;
UPDATE OFA_T_DOSSIER SET DOS_EXE_NOTES=(SELECT DOS_EXE_NOTES FROM OFA_T_DOSSIER_EXE WHERE DOS_ID=1 AND DOS_EXE_ID=1) WHERE DOS_ID=1;
UPDATE OFA_T_DOSSIER SET DOS_LAST_ENTRY=(SELECT DOS_EXE_LAST_ENTRY FROM OFA_T_DOSSIER_EXE WHERE DOS_ID=1 AND DOS_EXE_ID=1) WHERE DOS_ID=1;
UPDATE OFA_T_DOSSIER SET DOS_LAST_BAT=(SELECT DOS_EXE_LAST_BAT FROM OFA_T_DOSSIER_EXE WHERE DOS_ID=1 AND DOS_EXE_ID=1) WHERE DOS_ID=1;
UPDATE OFA_T_DOSSIER SET DOS_LAST_BATLINE=(SELECT DOS_EXE_LAST_BATLINE FROM OFA_T_DOSSIER_EXE WHERE DOS_ID=1 AND DOS_EXE_ID=1) WHERE DOS_ID=1;
UPDATE OFA_T_DOSSIER SET DOS_LAST_SETTLEMENT=(SELECT DOS_EXE_LAST_SETTLEMENT FROM OFA_T_DOSSIER_EXE WHERE DOS_ID=1 AND DOS_EXE_ID=1) WHERE DOS_ID=1;
UPDATE OFA_T_DOSSIER SET DOS_STATUS='C';

DROP TABLE OFA_T_DOSSIER_EXE;

DESCRIBE OFA_T_DOSSIER;
